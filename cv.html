<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - CV</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400&family=Abhaya+Libre:wght@800&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navigation">
        <a href="index.html" class="nav-logo">2</a>
        <a href="work.html" class="nav-item">WORK</a>
        <a href="cv.html" class="nav-item active">CV</a>
        <a href="contact.html" class="nav-item">CONTACT</a>
        <a href="studio_edul.html" class="nav-item">STUDIO EDUL</a>
    </nav>
    
    <div id="content-area">
        <!-- CV 데이터가 여기에 표시됩니다 -->
    </div>
    
    <script src="config.js"></script>
    <script src="notion-api.js"></script>
    <script>
        // CV 데이터 로드 및 Class별로 그룹화하여 표시
        async function loadCVClasses() {
            const contentArea = document.getElementById('content-area');
            
            // 항상 로딩 메시지 표시
            contentArea.innerHTML = '<div>로딩 중...</div>';
            
            try {
                // 캐시된 데이터 사용 (없으면 로드)
                const cvData = await getCVData();
                console.log('CV 데이터:', cvData);
                
                // Class별로 데이터 그룹화
                const classGroups = {};
                cvData.forEach(item => {
                    const properties = item.properties || {};
                    const classProperty = properties.Class || properties.class || properties.CLASS;
                    
                    if (classProperty && classProperty.select) {
                        const className = classProperty.select.name;
                        if (className) {
                            if (!classGroups[className]) {
                                classGroups[className] = [];
                            }
                            classGroups[className].push(item);
                        }
                    }
                });
                
                // 순서 정의
                const order = [
                    'EDUCATION',
                    'SOLO EXHIBITION',
                    'GROUP EXHIBITION',
                    'AWARDS',
                    'RESIDENCY',
                    'PARTICIPATED WORK'
                ];
                
                // 순서대로 정렬된 Class 목록
                const sortedClasses = Object.keys(classGroups).sort((a, b) => {
                    const indexA = order.indexOf(a);
                    const indexB = order.indexOf(b);
                    
                    if (indexA === -1 && indexB === -1) return 0;
                    if (indexA === -1) return 1;
                    if (indexB === -1) return -1;
                    return indexA - indexB;
                });
                
                console.log('Class 목록:', sortedClasses);
                
                // HTML 생성
                const classHtml = sortedClasses.map(className => {
                    const items = classGroups[className];
                    
                    // Class 제목
                    const classTitle = `<div class="cv-class-item">${className}</div>`;
                    
                    // 각 데이터 항목 생성
                    const itemsHtml = items.map(item => {
                        const properties = item.properties || {};
                        
                        // Period 필드 추출
                        const periodProperty = properties.Period || properties.period || properties.PERIOD ||
                                             properties.Date || properties.date || properties.DATE ||
                                             properties.Year || properties.year || properties.YEAR;
                        let period = '';
                        if (periodProperty) {
                            if (periodProperty.rich_text && periodProperty.rich_text.length > 0) {
                                period = periodProperty.rich_text.map(t => t.plain_text).join('');
                            } else if (periodProperty.title && periodProperty.title.length > 0) {
                                period = periodProperty.title.map(t => t.plain_text).join('');
                            } else if (periodProperty.date) {
                                period = periodProperty.date.start || '';
                            }
                        }
                        
                        // Name 필드 추출
                        const nameProperty = properties.Name || properties.name || properties.NAME ||
                                          properties.Title || properties.title || properties.TITLE;
                        let name = '';
                        if (nameProperty) {
                            if (nameProperty.title && nameProperty.title.length > 0) {
                                name = nameProperty.title.map(t => t.plain_text).join('');
                            } else if (nameProperty.rich_text && nameProperty.rich_text.length > 0) {
                                name = nameProperty.rich_text.map(t => t.plain_text).join('');
                            }
                        }
                        
                        // Client 필드 추출
                        const clientProperty = properties.Client || properties.client || properties.CLIENT ||
                                            properties.Cline || properties.cline || properties.CLINE ||
                                            properties.Venue || properties.venue || properties.VENUE;
                        let client = '';
                        if (clientProperty) {
                            if (clientProperty.rich_text && clientProperty.rich_text.length > 0) {
                                client = clientProperty.rich_text.map(t => t.plain_text).join('');
                            } else if (clientProperty.title && clientProperty.title.length > 0) {
                                client = clientProperty.title.map(t => t.plain_text).join('');
                            } else if (clientProperty.select) {
                                client = clientProperty.select.name || '';
                            }
                        }
                        
                        // Place 필드 추출
                        const placeProperty = properties.Place || properties.place || properties.PLACE ||
                                           properties.Location || properties.location || properties.LOCATION;
                        let place = '';
                        if (placeProperty) {
                            if (placeProperty.rich_text && placeProperty.rich_text.length > 0) {
                                place = placeProperty.rich_text.map(t => t.plain_text).join('');
                            } else if (placeProperty.title && placeProperty.title.length > 0) {
                                place = placeProperty.title.map(t => t.plain_text).join('');
                            } else if (placeProperty.select) {
                                place = placeProperty.select.name || '';
                            }
                        }
                        
                        return `
                            <div class="cv-data-item">
                                <div class="cv-data-period">${period || ''}</div>
                                <div class="cv-data-name-client">
                                    <span class="cv-data-name">${name || ''}</span>
                                    ${client ? `<span class="cv-data-separator"> | </span><span class="cv-data-client">${client}</span>` : ''}
                                </div>
                                <div class="cv-data-place">${place || ''}</div>
                            </div>
                        `;
                    }).join('');
                    
                    return `
                        <div class="cv-class-group">
                            ${classTitle}
                            <div class="cv-class-data">
                                ${itemsHtml}
                            </div>
                        </div>
                    `;
                }).join('');
                
                contentArea.innerHTML = classHtml;
            } catch (error) {
                console.error('CV 데이터 로드 오류:', error);
                contentArea.innerHTML = '<div>데이터를 불러오는 중 오류가 발생했습니다.</div>';
            }
        }
        
        // 페이지 로드 시 실행
        window.addEventListener('DOMContentLoaded', function() {
            loadCVClasses();
        });
    </script>
</body>
</html>

