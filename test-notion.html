<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion API 테스트</title>
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #000;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #333;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>Notion API 테스트</h1>
    
    <div class="test-section">
        <h2>설정 확인</h2>
        <p id="api-key-info"></p>
        <p id="database-info"></p>
    </div>

    <div class="test-section">
        <h2>데이터베이스 테스트</h2>
        <button onclick="testCV()">CV 데이터 가져오기</button>
        <button onclick="testWORK()">WORK 데이터 가져오기</button>
        <button onclick="testARTWORK()">ARTWORK 데이터 가져오기</button>
        <button onclick="testAll()">모든 데이터 가져오기</button>
        <div id="result" class="result"></div>
    </div>

    <script src="config.js"></script>
    <script src="notion-api.js"></script>
    <script>
        // 백엔드 API 엔드포인트 확인
        function checkConfig() {
            const apiEndpoint = NOTION_CONFIG.API_ENDPOINT;
            const apiKeyEl = document.getElementById('api-key-info');
            const databaseEl = document.getElementById('database-info');
            
            // API 엔드포인트 확인
            if (!apiEndpoint || apiEndpoint === 'https://your-project.vercel.app/api/notion') {
                apiKeyEl.innerHTML = '<span class="error">❌ API 엔드포인트가 설정되지 않았습니다. config.js 파일에 API_ENDPOINT를 설정해주세요.</span>';
                databaseEl.innerHTML = '<span class="error">백엔드 방식에서는 API 키와 DB ID는 Vercel 환경 변수에 설정되어 있습니다.</span>';
                return false;
            }
            
            apiKeyEl.innerHTML = `<span class="success">✅ API 엔드포인트가 설정되었습니다.</span><br>엔드포인트: ${apiEndpoint}`;
            databaseEl.innerHTML = '<span class="success">✅ 백엔드 방식 사용 중<br>API 키와 DB ID는 Vercel 환경 변수에 설정되어 있습니다.<br>데이터베이스: CV, WORK, ARTWORK</span>';
            
            return true;
        }

        function showResult(data, isError = false) {
            const resultEl = document.getElementById('result');
            if (isError) {
                resultEl.innerHTML = `<div class="error"><strong>오류:</strong><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
            } else {
                resultEl.innerHTML = `<div class="success"><strong>성공:</strong><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
            }
        }

        async function testCV() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>CV 데이터 가져오는 중...</div>';
            try {
                const data = await getCVData();
                showResult({ 
                    success: true,
                    database: 'CV',
                    results: data.length || 0,
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    database: 'CV',
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        async function testWORK() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>WORK 데이터 가져오는 중...</div>';
            try {
                const data = await getWORKData();
                showResult({ 
                    success: true,
                    database: 'WORK',
                    results: data.length || 0,
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    database: 'WORK',
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        async function testARTWORK() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>ARTWORK 데이터 가져오는 중...</div>';
            try {
                const data = await getARTWORKData();
                showResult({ 
                    success: true,
                    database: 'ARTWORK',
                    results: data.length || 0,
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    database: 'ARTWORK',
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        async function testAll() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>모든 데이터베이스에서 데이터 가져오는 중...</div>';
            try {
                const data = await getAllNotionData();
                showResult({ 
                    success: true,
                    CV: { results: data.CV?.length || 0 },
                    WORK: { results: data.WORK?.length || 0 },
                    ARTWORK: { results: data.ARTWORK?.length || 0 },
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        // 페이지 로드 시 설정 확인
        window.onload = checkConfig;
    </script>
</body>
</html>

