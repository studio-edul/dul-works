<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio - Work</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400&family=Abhaya+Libre:wght@800&display=swap" rel="stylesheet">
    <!-- Notion 이미지 도메인 미리 연결 -->
    <link rel="preconnect" href="https://www.notion.so">
    <link rel="dns-prefetch" href="https://www.notion.so">
</head>
<body>
    <nav class="navigation">
        <a href="index.html" class="nav-logo">2</a>
        <a href="work.html" class="nav-item active">WORK</a>
        <a href="cv.html" class="nav-item">CV</a>
        <a href="contact.html" class="nav-item">CONTACT</a>
        <a href="studio_edul.html" class="nav-item">STUDIO EDUL</a>
    </nav>
    
    <aside class="side-menu">
        <button class="side-menu-item" data-view="project">PROJECT</button>
        <button class="side-menu-item" data-view="exhibition">EXHIBITION</button>
        <button class="side-menu-item" data-view="timeline">TIMELINE</button>
    </aside>
    
    <div id="content-area">
        <!-- 뷰모드에 따라 내용이 변경됩니다 -->
    </div>
    
    <script src="config.js"></script>
    <script src="notion-api.js"></script>
    <script>
        // 현재 뷰모드 (기본값: project)
        let currentView = 'project';
        
        // 사이드 메뉴 클릭 이벤트
        document.querySelectorAll('.side-menu-item').forEach(item => {
            item.addEventListener('click', function() {
                const view = this.getAttribute('data-view');
                changeView(view);
            });
        });
        
        // 뷰모드 변경 함수
        function changeView(view) {
            currentView = view;
            
            // 모든 메뉴 아이템의 active 클래스 제거
            document.querySelectorAll('.side-menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 클릭된 메뉴 아이템에 active 클래스 추가
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            // 뷰모드에 따라 내용 변경
            renderContent(view);
        }
        
        // 이미지와 텍스트 오버레이를 생성하는 함수
        function createImageWithOverlay(imageUrl, name, timeline, description, isFullWidth = false) {
            if (!imageUrl) return '';
            
            const imageClass = isFullWidth ? 'project-image-full' : 'project-image';
            const containerClass = isFullWidth ? 'image-container-full' : 'image-container';
            
            // name, timeline, description 항상 표시 (없으면 "none")
            const nameHtml = `<div class="overlay-text-title">${name || 'none'}</div>`;
            const timelineHtml = `<div class="overlay-text-year">${timeline || 'none'}</div>`;
            const descriptionHtml = `<div class="overlay-text-caption">${description || 'none'}</div>`;
            
            return `
                <a href="#" class="image-link">
                    <div class="${containerClass}">
                        <img src="${imageUrl}" alt="${name || ''}" class="${imageClass}" loading="lazy" decoding="async">
                        <div class="overlay-text">
                            ${nameHtml}
                            ${timelineHtml}
                            ${descriptionHtml}
                        </div>
                    </div>
                </a>
            `;
        }
        
        // Artwork DB에서 이미지 가져오기 함수 (모든 일치하는 항목의 이미지)
        // artworkData를 파라미터로 받아서 중복 호출 방지
        async function loadArtworkImages(projectName, artworkData) {
            try {
                console.log('Artwork 이미지 로드:', projectName);
                
                // Project 필드가 name과 일치하는 모든 항목 찾기
                const matchingItems = artworkData.filter(item => {
                    const properties = item.properties || {};
                    
                    // Project 필드 추출
                    const projectProperty = properties.Project || properties.project || properties.PROJECT ||
                                          properties.Name || properties.name || properties.NAME;
                    
                    let projectValue = '';
                    if (projectProperty) {
                        if (projectProperty.title && projectProperty.title.length > 0) {
                            projectValue = projectProperty.title.map(t => t.plain_text).join('');
                        } else if (projectProperty.rich_text && projectProperty.rich_text.length > 0) {
                            projectValue = projectProperty.rich_text.map(t => t.plain_text).join('');
                        } else if (projectProperty.select) {
                            projectValue = projectProperty.select.name || '';
                        }
                    }
                    
                    return projectValue === projectName;
                });
                
                console.log('일치하는 항목 개수:', matchingItems.length);
                
                if (matchingItems.length === 0) {
                    return [];
                }
                
                // 모든 일치하는 항목의 이미지와 index, 텍스트 정보 가져오기
                const imagePromises = matchingItems.map(async (item) => {
                    const pageId = item.id;
                    const properties = item.properties || {};
                    
                    // Index 필드 추출 (모든 가능한 타입 처리)
                    const indexProperty = properties.Index || properties.index || properties.INDEX ||
                                        properties.Order || properties.order || properties.ORDER ||
                                        properties.Position || properties.position || properties.POSITION;
                    
                    let indexValue = null;
                    if (indexProperty) {
                        // rich_text 타입 처리
                        if (indexProperty.rich_text && indexProperty.rich_text.length > 0) {
                            const text = indexProperty.rich_text.map(t => t.plain_text).join('').trim();
                            indexValue = text || null;
                        }
                        // title 타입 처리
                        else if (indexProperty.title && indexProperty.title.length > 0) {
                            const text = indexProperty.title.map(t => t.plain_text).join('').trim();
                            indexValue = text || null;
                        }
                        // number 타입 처리
                        else if (typeof indexProperty.number === 'number') {
                            indexValue = indexProperty.number.toString();
                        }
                        // select 타입 처리
                        else if (indexProperty.select) {
                            indexValue = indexProperty.select.name ? indexProperty.select.name.trim() : null;
                        }
                        // formula 타입 처리
                        else if (indexProperty.formula) {
                            if (indexProperty.formula.string) {
                                indexValue = indexProperty.formula.string.trim();
                            } else if (indexProperty.formula.number) {
                                indexValue = indexProperty.formula.number.toString();
                            }
                        }
                    }
                    
                    console.log(`[${projectName}] Index 필드 추출 결과:`, {
                        property: indexProperty ? '있음' : '없음',
                        type: indexProperty ? indexProperty.type : '없음',
                        value: indexValue
                    });
                    
                    // Name 필드 추출
                    const nameProperty = properties.Name || properties.name || properties.NAME ||
                                        properties.Title || properties.title || properties.TITLE;
                    let name = '';
                    if (nameProperty) {
                        if (nameProperty.title && nameProperty.title.length > 0) {
                            name = nameProperty.title.map(t => t.plain_text).join('');
                        } else if (nameProperty.rich_text && nameProperty.rich_text.length > 0) {
                            name = nameProperty.rich_text.map(t => t.plain_text).join('');
                        }
                    }
                    
                    // Timeline 필드 추출 (더 많은 변형 시도)
                    const timelineProperty = properties.Timeline || properties.timeline || properties.TIMELINE ||
                                          properties['Timeline'] || properties['timeline'] || properties['TIMELINE'] ||
                                          properties.Date || properties.date || properties.DATE ||
                                          properties.Time || properties.time || properties.TIME ||
                                          properties.Year || properties.year || properties.YEAR;
                    let timeline = '';
                    if (timelineProperty) {
                        // select 타입 처리
                        if (timelineProperty.select) {
                            timeline = timelineProperty.select.name || '';
                        }
                        // rich_text 타입 처리
                        else if (timelineProperty.rich_text && timelineProperty.rich_text.length > 0) {
                            timeline = timelineProperty.rich_text.map(t => t.plain_text).join('');
                        }
                        // title 타입 처리
                        else if (timelineProperty.title && timelineProperty.title.length > 0) {
                            timeline = timelineProperty.title.map(t => t.plain_text).join('');
                        }
                        // date 타입 처리
                        else if (timelineProperty.date) {
                            timeline = timelineProperty.date.start || '';
                        }
                        // number 타입 처리
                        else if (timelineProperty.number) {
                            timeline = timelineProperty.number.toString();
                        }
                    }
                    
                    // Description 필드 추출
                    const descriptionProperty = properties.Description || properties.description || properties.DESCRIPTION ||
                                              properties['Description EN'] || properties['description en'] ||
                                              properties['Description En'] || properties['Description en'];
                    let description = '';
                    if (descriptionProperty) {
                        if (descriptionProperty.rich_text && descriptionProperty.rich_text.length > 0) {
                            description = descriptionProperty.rich_text.map(t => t.plain_text).join('');
                        } else if (descriptionProperty.title && descriptionProperty.title.length > 0) {
                            description = descriptionProperty.title.map(t => t.plain_text).join('');
                        }
                    }
                    
                    // 페이지의 블록 가져오기
                    const blocks = await getPageBlocks(pageId);
                    console.log(`[${projectName}] 페이지 블록 개수:`, blocks ? blocks.length : 0, 'pageId:', pageId);
                    
                    // 블록에서 첫 번째 이미지 찾기
                    let imageUrl = null;
                    if (blocks && blocks.length > 0) {
                        for (const block of blocks) {
                            if (block.type === 'image') {
                                const image = block.image;
                                if (image) {
                                    if (image.file) {
                                        imageUrl = image.file.url;
                                        console.log(`[${projectName}] 블록에서 이미지 URL 찾음 (file)`);
                                    } else if (image.external) {
                                        imageUrl = image.external.url;
                                        console.log(`[${projectName}] 블록에서 이미지 URL 찾음 (external)`);
                                    }
                                }
                                if (imageUrl) break;
                            }
                        }
                    }
                    
                    // 블록에서 이미지를 못 찾으면 cover 이미지 확인
                    if (!imageUrl && item.cover) {
                        if (item.cover.file) {
                            imageUrl = item.cover.file.url;
                            console.log(`[${projectName}] Cover 이미지 URL 찾음 (file)`);
                        } else if (item.cover.external) {
                            imageUrl = item.cover.external.url;
                            console.log(`[${projectName}] Cover 이미지 URL 찾음 (external)`);
                        }
                    }
                    
                    if (!imageUrl) {
                        console.warn(`[${projectName}] ⚠️ 이미지 URL을 찾을 수 없습니다. pageId:`, pageId);
                    }
                    
                    const result = {
                        url: imageUrl,
                        index: indexValue,
                        name: name,
                        timeline: timeline,
                        description: description
                    };
                    
                    console.log(`[${projectName}] 이미지 추출 결과:`, {
                        imageUrl: imageUrl ? '있음' : '없음',
                        index: indexValue,
                        name: name || '없음'
                    });
                    
                    return result;
                });
                
                const imageData = await Promise.all(imagePromises);
                console.log(`[${projectName}] 모든 이미지 Promise 완료, 원본 데이터:`, imageData);
                
                const validImageData = imageData.filter(data => data.url !== null);
                console.log(`[${projectName}] 유효한 이미지 데이터 개수:`, validImageData.length);
                
                if (validImageData.length > 0) {
                    console.log(`[${projectName}] 이미지 데이터 상세:`, validImageData.map(img => ({
                        url: img.url ? '있음' : '없음',
                        index: img.index,
                        name: img.name
                    })));
                } else {
                    console.warn(`[${projectName}] 유효한 이미지가 없습니다. 원본 데이터:`, imageData);
                }
                
                return validImageData;
            } catch (error) {
                console.error('Artwork 이미지 로드 오류:', error);
                return [];
            }
        }
        
        // 내용 렌더링 함수
        async function renderContent(view) {
            const contentArea = document.getElementById('content-area');
            
            // 로딩 메시지 표시
            contentArea.innerHTML = `
                <div class="columns-container">
                    <div class="column">
                        <div>로딩 중...</div>
                    </div>
                    <div class="column"></div>
                </div>
            `;
            
            try {
                if (view === 'project') {
                    // 캐시된 데이터 사용 (없으면 로드)
                    const [workData, artworkData] = await Promise.all([
                        getWORKData(),
                        getARTWORKData()
                    ]);
                    
                    // class가 PROJECT인 항목들 필터링
                    const projectItems = workData.filter(item => {
                        const properties = item.properties || {};
                        
                        // 다양한 필드명 시도
                        const classProperty = properties.Class || properties.class || properties.CLASS || 
                                           properties.Type || properties.type || properties.TYPE ||
                                           properties.Category || properties.category || properties.CATEGORY;
                        
                        if (!classProperty) {
                            return false;
                        }
                        
                        // Notion API의 select 타입 처리
                        let classValue = '';
                        if (classProperty.select) {
                            classValue = classProperty.select.name || '';
                        } else if (classProperty.rich_text && classProperty.rich_text.length > 0) {
                            classValue = classProperty.rich_text[0].plain_text || '';
                        } else if (classProperty.title && classProperty.title.length > 0) {
                            classValue = classProperty.title[0].plain_text || '';
                        }
                        
                        return classValue.toUpperCase() === 'PROJECT';
                    });
                    
                    // Name 데이터 추출 및 표시
                    if (projectItems.length === 0) {
                        contentArea.innerHTML = `
                            <div class="columns-container">
                                <div class="column">
                                    <div class="project-item">프로젝트 데이터가 없습니다.</div>
                                </div>
                                <div class="column"></div>
                            </div>
                        `;
                    } else {
                        // Name과 Index 데이터 추출
                        const itemsWithData = projectItems.map((item, index) => {
                            const properties = item.properties || {};
                            
                            // Name 필드 추출
                            const nameProperty = properties.Name || properties.name || properties.NAME ||
                                               properties.Title || properties.title || properties.TITLE;
                            
                            let name = '';
                            if (nameProperty) {
                                // Notion API의 title 타입 처리
                                if (nameProperty.title && nameProperty.title.length > 0) {
                                    name = nameProperty.title.map(t => t.plain_text).join('');
                                }
                                // rich_text 타입 처리
                                else if (nameProperty.rich_text && nameProperty.rich_text.length > 0) {
                                    name = nameProperty.rich_text.map(t => t.plain_text).join('');
                                }
                            }
                            
                            // Index 필드 추출
                            const indexProperty = properties.Index || properties.index || properties.INDEX ||
                                                properties.Order || properties.order || properties.ORDER ||
                                                properties.Number || properties.number || properties.NUMBER;
                            
                            let indexValue = null;
                            if (indexProperty) {
                                // number 타입 처리
                                if (typeof indexProperty.number === 'number') {
                                    indexValue = indexProperty.number;
                                }
                                // rich_text 타입 처리
                                else if (indexProperty.rich_text && indexProperty.rich_text.length > 0) {
                                    const text = indexProperty.rich_text[0].plain_text || '';
                                    indexValue = parseInt(text, 10);
                                }
                                // title 타입 처리
                                else if (indexProperty.title && indexProperty.title.length > 0) {
                                    const text = indexProperty.title[0].plain_text || '';
                                    indexValue = parseInt(text, 10);
                                }
                            }
                            
                            // Period 필드 추출
                            const periodProperty = properties.Period || properties.period || properties.PERIOD ||
                                                 properties.Date || properties.date || properties.DATE ||
                                                 properties.Year || properties.year || properties.YEAR ||
                                                 properties.Time || properties.time || properties.TIME;
                            
                            let period = '';
                            if (periodProperty) {
                                // date 타입 처리
                                if (periodProperty.date) {
                                    const date = periodProperty.date;
                                    if (date.start) {
                                        period = date.start;
                                        if (date.end) {
                                            period += ' - ' + date.end;
                                        }
                                    }
                                }
                                // rich_text 타입 처리
                                else if (periodProperty.rich_text && periodProperty.rich_text.length > 0) {
                                    period = periodProperty.rich_text.map(t => t.plain_text).join('');
                                }
                                // title 타입 처리
                                else if (periodProperty.title && periodProperty.title.length > 0) {
                                    period = periodProperty.title.map(t => t.plain_text).join('');
                                }
                                // select 타입 처리
                                else if (periodProperty.select) {
                                    period = periodProperty.select.name || '';
                                }
                            }
                            
                            // Description EN 필드 추출
                            const descriptionProperty = properties['Description EN'] || properties['description en'] || 
                                                       properties['Description En'] || properties['Description en'] ||
                                                       properties['DESCRIPTION EN'] || properties['DescriptionEN'] ||
                                                       properties['descriptionEN'] || properties['Description'] ||
                                                       properties['description'] || properties['DESCRIPTION'];
                            
                            let description = '';
                            if (descriptionProperty) {
                                // rich_text 타입 처리
                                if (descriptionProperty.rich_text && descriptionProperty.rich_text.length > 0) {
                                    // CSS white-space: pre-wrap으로 처리하므로 텍스트만 추출
                                    description = descriptionProperty.rich_text.map((t, idx) => {
                                        let text = t.plain_text || '';
                                        // CSS로 줄바꿈 처리하므로 <br> 추가하지 않음
                                        // if (t.annotations && t.annotations.hard_break) {
                                        //     text += '<br>';
                                        // }
                                        return text;
                                    }).join('');
                                    
                                    // CSS white-space: pre-wrap으로 처리하므로 replace 로직 주석처리
                                    // // \n을 기준으로 문단 나누기: \n 앞에서 </p> 닫고, \n 뒤에서 <p> 열기
                                    // // \n 자체는 제거됨
                                    // description = description.replace(/\n/g, '</p><p>');
                                    // // 연속된 </p><p></p><p>를 하나로 정리 (빈 문단 제거)
                                    // description = description.replace(/(<\/p><p>)+/g, '</p><p>');
                                    // // 문단 태그로 감싸기
                                    // if (description) {
                                    //     description = '<p>' + description + '</p>';
                                    // }
                                }
                                // title 타입 처리
                                else if (descriptionProperty.title && descriptionProperty.title.length > 0) {
                                    description = descriptionProperty.title.map(t => t.plain_text).join('');
                                    // CSS white-space: pre-wrap으로 처리하므로 replace 로직 주석처리
                                    // // \n을 기준으로 문단 나누기: \n 앞에서 </p> 닫고, \n 뒤에서 <p> 열기
                                    // // \n 자체는 제거됨
                                    // description = description.replace(/\n/g, '</p><p>');
                                    // // 연속된 </p><p></p><p>를 하나로 정리 (빈 문단 제거)
                                    // description = description.replace(/(<\/p><p>)+/g, '</p><p>');
                                    // if (description) {
                                    //     description = '<p>' + description + '</p>';
                                    // }
                                }
                            }
                            
                            return {
                                name: name || null,
                                index: indexValue !== null && !isNaN(indexValue) ? indexValue : null,
                                period: period || '',
                                description: description || ''
                            };
                        }).filter(item => item.name !== null);
                        
                        // Index 기준으로 정렬 (Index가 없는 항목은 맨 뒤로)
                        itemsWithData.sort((a, b) => {
                            if (a.index === null && b.index === null) return 0;
                            if (a.index === null) return 1;
                            if (b.index === null) return -1;
                            return a.index - b.index;
                        });
                        
                        if (itemsWithData.length === 0) {
                            contentArea.innerHTML = `
                                <div class="columns-container">
                                    <div class="column">
                                        <div class="project-item">프로젝트 데이터가 없습니다.</div>
                                    </div>
                                    <div class="column"></div>
                                </div>
                            `;
                        } else {
                            // 모든 항목에 대해 이미지 로드 (캐시된 artworkData 사용)
                            const imagePromises = itemsWithData.map(item => 
                                loadArtworkImages(item.name, artworkData).then(imageDataArray => {
                                    console.log(`[${item.name}] 이미지 데이터 로드 완료:`, imageDataArray.length, '개');
                                    console.log(`[${item.name}] 이미지 데이터 상세:`, imageDataArray);
                                    return {
                                        ...item,
                                        imageHtml: imageDataArray
                                    };
                                })
                            );
                            
                            Promise.all(imagePromises).then(itemsWithImages => {
                                console.log('모든 이미지 로드 완료, 렌더링 시작');
                                
                                // 각 name별로 컨테이너 생성
                                const nameContainers = itemsWithImages.map(item => {
                                    const nameHtml = `<div class="project-item">${item.name}</div>`;
                                    const periodHtml = item.period ? `<div class="project-period">${item.period}</div>` : '';
                                    // CSS white-space: pre-wrap으로 처리하므로 \n 제거하지 않음
                                    let cleanDescription = item.description || '';
                                    const descriptionContent = periodHtml + cleanDescription;
                                    const descriptionHtml = descriptionContent ? `<div class="description-box">${descriptionContent}</div>` : '';
                                    
                                    // 텍스트와 이미지를 함께 2열로 배치
                                    // 텍스트는 왼쪽 열에, 이미지들은 2열에 분산 배치
                                    const leftColumnContent = [];
                                    const rightColumnContent = [];
                                    
                                    // 텍스트를 왼쪽 열에 추가
                                    leftColumnContent.push(`
                                        <a href="#" class="project-link">
                                            ${nameHtml}
                                            ${descriptionHtml}
                                        </a>
                                    `);
                                    
                                    // 이미지들을 index 좌표에 따라 배치
                                    // index 형식: "열,행" (예: "2,3" = 2번째 열의 3번째 위치)
                                    // "full" = 두 열을 모두 차지하는 이미지
                                    const columnArrays = {
                                        1: [],
                                        2: []
                                    };
                                    const fullWidthImages = [];
                                    
                                    console.log(`[${item.name}] 이미지 HTML 배열 길이:`, item.imageHtml ? item.imageHtml.length : 0);
                                    
                                    if (item.imageHtml && item.imageHtml.length > 0) {
                                        console.log(`[${item.name}] 렌더링 시작 - 이미지 개수:`, item.imageHtml.length);
                                        item.imageHtml.forEach((imageData, idx) => {
                                            console.log(`[${item.name}] 이미지 ${idx + 1}/${item.imageHtml.length}:`, {
                                                url: imageData.url ? imageData.url.substring(0, 50) + '...' : '없음',
                                                index: imageData.index || '없음',
                                                name: imageData.name || '없음'
                                            });
                                            
                                            if (!imageData.url || imageData.url === '') {
                                                console.warn(`[${item.name}] ⚠️ 이미지 ${idx + 1}: URL이 없어서 건너뜁니다.`);
                                                return;
                                            }
                                            
                                            if (!imageData.index) {
                                                // index가 없으면 기본 순서로 추가
                                                console.log(`[${item.name}] 이미지 ${idx + 1}: index 없음, 기본 위치(1열)에 추가`);
                                                const imageWithOverlay = createImageWithOverlay(imageData.url, imageData.name, imageData.timeline, imageData.description);
                                                columnArrays[1].push(imageWithOverlay);
                                                return;
                                            }
                                            
                                            // "full" 체크
                                            const indexStr = imageData.index.toString().trim();
                                            if (indexStr.toLowerCase() === 'full') {
                                                console.log(`[${item.name}] 이미지 ${idx + 1}: full-width 이미지로 처리`);
                                                const imageWithOverlay = createImageWithOverlay(imageData.url, imageData.name, imageData.timeline, imageData.description, true);
                                                fullWidthImages.push(imageWithOverlay);
                                                return;
                                            }
                                            
                                            // index 파싱 (예: "2,3" -> column=2, row=3)
                                            console.log(`[${item.name}] 이미지 ${idx + 1}: index 파싱 시도 - "${indexStr}"`);
                                            const parts = indexStr.split(',');
                                            
                                            if (parts.length === 2) {
                                                const column = parseInt(parts[0].trim(), 10);
                                                const row = parseInt(parts[1].trim(), 10);
                                                
                                                console.log(`[${item.name}] 이미지 ${idx + 1}: 파싱 결과 - column=${column}, row=${row}`);
                                                
                                                if (!isNaN(column) && !isNaN(row) && (column === 1 || column === 2)) {
                                                    // 이미지와 텍스트 오버레이 생성
                                                    const imageWithOverlay = createImageWithOverlay(imageData.url, imageData.name, imageData.timeline, imageData.description);
                                                    
                                                    // 배열 크기를 확장하여 필요한 위치까지 빈 요소 추가
                                                    while (columnArrays[column].length < row) {
                                                        columnArrays[column].push('');
                                                    }
                                                    
                                                    // row-1 위치에 이미지 삽입 (row는 1부터 시작)
                                                    columnArrays[column][row - 1] = imageWithOverlay;
                                                    console.log(`[${item.name}] 이미지 ${idx + 1}: ${column}열 ${row}행에 배치 완료`);
                                                } else {
                                                    console.warn(`[${item.name}] 이미지 ${idx + 1}: 유효하지 않은 column/row 값 (column=${column}, row=${row})`);
                                                }
                                            } else {
                                                console.warn(`[${item.name}] 이미지 ${idx + 1}: index 형식 오류 - "${indexStr}" (예상 형식: "열,행" 또는 "full")`);
                                            }
                                        });
                                    } else {
                                        console.warn(`[${item.name}]: 이미지 데이터가 없습니다.`);
                                    }
                                    
                                    console.log(`[${item.name}] 최종 배치 - 1열: ${columnArrays[1].filter(img => img !== '').length}개, 2열: ${columnArrays[2].filter(img => img !== '').length}개, full-width: ${fullWidthImages.length}개`);
                                    
                                    // 각 열의 배열을 문자열로 변환 (빈 요소 제거)
                                    leftColumnContent.push(...columnArrays[1].filter(img => img !== ''));
                                    rightColumnContent.push(...columnArrays[2].filter(img => img !== ''));
                                    
                                    // full-width 이미지 HTML 생성
                                    const fullWidthImagesHtml = fullWidthImages.join('');
                                    
                                    return `
                                        <div class="name-container">
                                            <div class="columns-container">
                                                <div class="column">
                                                    ${leftColumnContent.join('')}
                                                </div>
                                                <div class="column">
                                                    ${rightColumnContent.join('')}
                                                </div>
                                            </div>
                                            ${fullWidthImagesHtml}
                                        </div>
                                    `;
                                });
                                
                                contentArea.innerHTML = nameContainers.join('');
                            }).catch(error => {
                                console.error('이미지 로드 오류:', error);
                                // 이미지 없이도 표시
                                const nameContainers = itemsWithData.map(item => {
                                    const nameHtml = `<div class="project-item">${item.name}</div>`;
                                    const periodHtml = item.period ? `<div class="project-period">${item.period}</div>` : '';
                                    // CSS white-space: pre-wrap으로 처리하므로 \n 제거하지 않음
                                    let cleanDescription = item.description || '';
                                    const descriptionContent = periodHtml + cleanDescription;
                                    const descriptionHtml = descriptionContent ? `<div class="description-box">${descriptionContent}</div>` : '';
                                    
                                    return `
                                        <div class="name-container">
                                            <div class="columns-container">
                                                <div class="column">
                                                    <a href="#" class="project-link">
                                                        ${nameHtml}
                                                        ${descriptionHtml}
                                                    </a>
                                                </div>
                                                <div class="column"></div>
                                            </div>
                                        </div>
                                    `;
                                });
                                
                                contentArea.innerHTML = nameContainers.join('');
                            });
                        }
                    }
                } else if (view === 'exhibition') {
                    contentArea.innerHTML = `
                        <div class="columns-container">
                            <div class="column">
                                <div>EXHIBITION 뷰 (구현 예정)</div>
                            </div>
                            <div class="column"></div>
                        </div>
                    `;
                } else if (view === 'timeline') {
                    contentArea.innerHTML = `
                        <div class="columns-container">
                            <div class="column">
                                <div>TIMELINE 뷰 (구현 예정)</div>
                            </div>
                            <div class="column"></div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('데이터 로드 오류:', error);
                console.error('오류 스택:', error.stack);
                contentArea.innerHTML = `
                    <div class="columns-container">
                        <div class="column">
                            <div class="project-item">데이터를 불러오는 중 오류가 발생했습니다.</div>
                        </div>
                        <div class="column"></div>
                    </div>
                `;
            }
        }
        
        // 페이지 로드 시 기본 뷰모드 설정 및 데이터 로드
        window.addEventListener('DOMContentLoaded', function() {
            changeView('project');
        });
    </script>
</body>
</html>


